# Production Environment Variables for 2GB Memory Server
# Copy these to your Render dashboard → Environment tab

# ============================================
# RECOMMENDED: Keep monitoring, disable only problematic services
# ============================================

# Keep memory monitoring enabled (you have 2GB)
ENABLE_MEMORY_MONITORING=true

# Keep comprehensive monitoring but with longer intervals
ENABLE_COMPREHENSIVE_MONITORING=true

# Disable background services that poll frequently
ENABLE_BACKGROUND_SERVICES=false

# ============================================
# Memory Configuration for 2GB Server
# ============================================

MEMORY_LIMIT=2048
RENDER=true
RENDER_PRO=true

# Node.js heap size (leave ~500MB for system)
NODE_OPTIONS=--max-old-space-size=1536

# ============================================
# Database Configuration
# ============================================

# Your existing DATABASE_URL
# DATABASE_URL=postgresql://user:password@host:port/database

# Database connection pool - increase for 2GB server
DB_MAX_CONNECTIONS=10

# Connection timeout settings
DB_IDLE_TIMEOUT=30
DB_CONNECT_TIMEOUT=3

# ============================================
# Performance Tuning for 2GB
# ============================================

# Enable caching (you have memory for it)
ENABLE_CACHING=true
CACHE_MAX_SIZE=500

# Enable compression
ENABLE_COMPRESSION=true

# ============================================
# Logging
# ============================================

# Use info level for better debugging
LOG_LEVEL=info

# ============================================
# ALTERNATIVE: Minimal Mode (if still having issues)
# ============================================

# Uncomment these if you still see 503 errors:
# ENABLE_MEMORY_MONITORING=false
# ENABLE_COMPREHENSIVE_MONITORING=false
# ENABLE_BACKGROUND_SERVICES=false

# ============================================
# IMPORTANT NOTES FOR 2GB SERVER
# ============================================
# 
# With 2GB memory, the issue is likely NOT memory exhaustion.
# Possible causes:
# 
# 1. CPU saturation from too many interval timers
#    → Solution: Keep services disabled or increase intervals
# 
# 2. Database connection pool exhaustion
#    → Solution: Increase DB_MAX_CONNECTIONS to 10-15
# 
# 3. Specific memory leak in a service
#    → Solution: Monitor which service is leaking
# 
# 4. Event loop blocking
#    → Solution: Profile with clinic.js
# 
# 5. Too many concurrent requests
#    → Solution: Add rate limiting
#
# RECOMMENDATION:
# - Start with ENABLE_BACKGROUND_SERVICES=false
# - Keep monitoring enabled to track memory
# - Monitor logs to see actual memory usage
# - If memory stays < 1GB, the issue is CPU/event loop, not memory
#